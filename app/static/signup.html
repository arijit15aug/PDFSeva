<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sign up</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .glass{background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.18);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
    .shine{background:radial-gradient(600px circle at 20% 10%, rgba(255,255,255,.35), transparent 55%),radial-gradient(700px circle at 80% 20%, rgba(255,255,255,.22), transparent 55%),radial-gradient(700px circle at 50% 80%, rgba(255,255,255,.18), transparent 55%)}
    .btn{transition:.15s}
    .btn:active{transform:translateY(1px)}
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-fuchsia-600">
  <div class="min-h-screen shine">
    <div class="max-w-lg mx-auto px-4 py-10">
      <div class="glass rounded-3xl p-6 md:p-8 shadow-2xl">
        <div class="flex items-center justify-between">
          <h1 class="text-2xl md:text-3xl font-black text-white">Create account</h1>
          <a href="/" class="text-white/80 hover:text-white text-sm font-semibold">Back</a>
        </div>

        <p class="text-white/70 mt-2">Sign up to access your dashboard.</p>

        <div id="msg" class="hidden mt-4 rounded-2xl px-4 py-3 text-sm font-semibold"></div>

        <form id="form" class="mt-6 space-y-3">
          <div>
            <label class="text-white/80 text-sm font-semibold">Email</label>
            <input id="email" name="email" type="email" required autocomplete="email"
              class="mt-1 w-full rounded-2xl bg-white/10 border border-white/20 text-white placeholder:text-white/40 px-4 py-3 outline-none focus:border-white/40"
              placeholder="you@example.com">
          </div>

          <div>
            <div class="flex items-center justify-between">
              <label class="text-white/80 text-sm font-semibold">Password</label>
              <button id="togglePw" type="button" class="text-white/70 hover:text-white text-xs font-semibold underline">
                Show
              </button>
            </div>

            <input id="password" name="password" type="password" required minlength="6" autocomplete="new-password"
              class="mt-1 w-full rounded-2xl bg-white/10 border border-white/20 text-white placeholder:text-white/40 px-4 py-3 outline-none focus:border-white/40"
              placeholder="Minimum 6 characters">

            <div class="mt-1 text-xs text-white/60">
              Tip: use at least 6 characters.
            </div>
          </div>

          <button id="btn" type="submit"
            class="btn w-full rounded-2xl bg-white text-slate-900 font-extrabold px-4 py-3 shadow-lg hover:opacity-95">
            Sign up
          </button>

          <div class="text-center text-white/80 text-sm">
            Already have an account?
            <a class="underline font-semibold hover:text-white" href="/auth/login">Sign in</a>
          </div>
        </form>

      </div>
    </div>
  </div>

  <script>
    (() => {
      const f = document.getElementById("form");
      const b = document.getElementById("btn");
      const m = document.getElementById("msg");
      const pw = document.getElementById("password");
      const togglePw = document.getElementById("togglePw");

      const show = (t, ok) => {
        m.className =
          "mt-4 rounded-2xl px-4 py-3 text-sm font-semibold " +
          (ok
            ? "bg-emerald-400/20 text-emerald-50 border border-emerald-300/20"
            : "bg-red-400/20 text-red-50 border border-red-300/20");
        m.textContent = t;
        m.classList.remove("hidden");
      };

      const hide = () => m.classList.add("hidden");

      togglePw.addEventListener("click", () => {
        const isPw = pw.type === "password";
        pw.type = isPw ? "text" : "password";
        togglePw.textContent = isPw ? "Hide" : "Show";
      });

      async function readErrorMessage(resp){
        // tries JSON first, then text
        try{
          const j = await resp.json();
          if (j && typeof j === "object") return j.detail || j.error || "Signup failed";
        }catch(_){}
        try{
          const t = (await resp.text()) || "";
          // if server returns plain text error
          if (t.trim()) return t.trim().slice(0, 300);
        }catch(_){}
        return "Signup failed";
      }

      f.addEventListener("submit", async (e) => {
        e.preventDefault();
        hide();

        b.disabled = true;
        b.textContent = "Creatingâ€¦";

        try {
          const fd = new FormData(f);
          const r = await fetch("/auth/signup", { method: "POST", body: fd, redirect: "follow" });

          if (r.redirected) {
            location.href = r.url;
            return;
          }
          if (r.ok) {
            location.href = "/dashboard";
            return;
          }

          const msg = await readErrorMessage(r);
          show(msg, false);
        } catch (err) {
          show("Network error", false);
        } finally {
          b.disabled = false;
          b.textContent = "Sign up";
        }
      });
    })();
  </script>
</body>
</html>